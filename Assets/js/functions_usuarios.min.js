function fntRolesUsuario(){let e=BaseUrl+"/Roles/GetSelectRoles",t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e,!0),t.send(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.querySelector("#listRolId").innerHTML=t.responseText,$("#listRolId").selectpicker("refresh"),$("#listStatus").selectpicker("refresh"))}}function fntOrganizacion(){let e=BaseUrl+"/Organizaciones/GetSelectOrganizaciones",t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e,!0),t.send(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.querySelector("#listOrganizacionId").innerHTML=t.responseText,$("#listOrganizacionId").selectpicker("refresh"))}}function fntViewUsuario(e){let t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),a=BaseUrl+"/Usuarios/GetUsuario/"+e;t.open("GET",a,!0),t.send(),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);if(e.estado){let t=1==e.data.estado?'<span class="badge badge-success">Activo</span>':'<span class="badge badge-danger">Inactivo</span>';document.querySelector("#celIdentificacion").innerHTML=e.data.numero_identificacion,document.querySelector("#celNombres").innerHTML=e.data.nombres,document.querySelector("#celApellidos").innerHTML=e.data.apellidos,document.querySelector("#celTelefono").innerHTML=e.data.telefono,document.querySelector("#celEmail").innerHTML=e.data.email,document.querySelector("#celTipoUsuario").innerHTML=e.data.nombrerol,document.querySelector("#celEstado").innerHTML=t,document.querySelector("#celOrganizacion").innerHTML=e.data.nombre,document.querySelector("#celFechaRegistro").innerHTML=e.data.fechaRegistro,$("#modalViewUser").modal("show")}else swal("¡Error!",e.msg,"error")}}}function fntEditUsuario(e,t){rowTable=e.parentNode.parentNode.parentNode,document.querySelector(".modal-header").classList.replace("headerRegister","headerUpdate"),document.querySelector("#btnActionForm").classList.replace("btn-primary","btn-info"),document.querySelector("#btnText").innerHTML="Actualizar",document.querySelector("#titleModal").innerHTML="Actualizar Usuario";let a=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),o=BaseUrl+"/Usuarios/GetUsuario/"+t;a.open("GET",o,!0),a.send(),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){let e=JSON.parse(a.responseText);e.estado?(document.querySelector("#idUsuario").value=e.data.idpersona,document.querySelector("#txtIdentificacion").value=e.data.numero_identificacion,document.querySelector("#txtNombres").value=e.data.nombres,document.querySelector("#txtApellidos").value=e.data.apellidos,document.querySelector("#txtTelefono").value=e.data.telefono,document.querySelector("#txtEmail").value=e.data.email,document.querySelector("#listRolId").value=e.data.idrol,document.querySelector("#listOrganizacionId").value=e.data.idOrganizacion,document.querySelector("#listStatus").value=e.data.estado,$("#listRolId").selectpicker("refresh"),$("#listStatus").selectpicker("refresh"),$("#listOrganizacionId").selectpicker("refresh"),$("#modalFormUsuario").modal("show")):swal("¡Error!",e.msg,"error")}}}function fntDelUsuario(e){swal({title:"Eliminar Usuario",text:"¿Realente quiere eliminar el Usuario?",type:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){if(t){divLoading.style.display="flex";let t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),a=BaseUrl+"/Usuarios/DelUsuario/",o="idUsuario="+e;t.open("POST",a,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(o),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);e.estado?(swal("¡Eliminar!",e.msg,"success"),tableUsuarios.api().ajax.reload()):swal("¡Error!",e.msg,"error")}return divLoading.style.display="none",!1}}})}function openModal(){rowTable="",document.querySelector("#idUsuario").value="",document.querySelector(".modal-header").classList.replace("headerUpdate","headerRegister"),document.querySelector("#btnActionForm").classList.replace("btn-info","btn-primary"),document.querySelector("#btnText").innerHTML="Guardar",document.querySelector("#titleModal").innerHTML="Nuevo Usuario",document.querySelector("#formUsuario").reset(),$("#modalFormUsuario").modal("show")}let tableUsuarios,rowTable,divLoading=document.querySelector("#divLoading");document.addEventListener("DOMContentLoaded",function(){tableUsuarios=$("#tableUsuarios").dataTable({aProcessing:!0,aServerSide:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"},ajax:{url:BaseUrl+"/Usuarios/GetUsuarios",dataSrc:""},columns:[{data:"idPersona"},{data:"nombres"},{data:"apellidos"},{data:"email"},{data:"telefono"},{data:"nombreRol"},{data:"nombre"},{data:"estado"},{data:"options"}],dom:"lBfrtip",buttons:[{extend:"copyHtml5",text:"<i class='fas fa-copy'></i> Copiar",titleAttr:"Copiar",className:"btn btn-secondary"},{extend:"excelHtml5",text:"<i class='fas fa-file-excel'></i> Excel",titleAttr:"Exportar a Excel",className:"btn btn-success"},{extend:"pdfHtml5",text:"<i class='fas fa-file-pdf'></i> PDF",titleAttr:"Exportar a PDF",className:"btn btn-danger"},{extend:"csvHtml5",text:"<i class='fas fa-file-csv'></i> CSV",titleAttr:"Exportar a CSV",className:"btn btn-info"}],responsive:"true",bDestroy:!0,iDisplayLength:10,order:[[1,"asc"]]});let e=document.querySelector("#formUsuario");e.onsubmit=function(t){t.preventDefault();let a=document.querySelector("#txtIdentificacion").value,o=document.querySelector("#txtNombres").value,r=document.querySelector("#txtApellidos").value,n=document.querySelector("#txtEmail").value,s=document.querySelector("#txtTelefono").value,l=document.querySelector("#listRolId").value,i=(document.querySelector("#txtPassword").value,document.querySelector("#listStatus").value),c=document.querySelector("#listOrganizacionId").value;if(""==a||""==o||""==r||""==n||""==s||""==l||""==c)return swal("Atención","Todos los campos son obligatorios","error"),!1;let d=document.getElementsByClassName("valid");for(let e=0;e<d.length;e++)if(d[e].classList.contains("is-invalid"))return swal("Atención","Por favor verifique los campos en rojo.","error"),!1;divLoading.style.display="flex";let u=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),m=BaseUrl+"/Usuarios/SetUsuario",p=new FormData(e);u.open("POST",m,!0),u.send(p),u.onreadystatechange=function(){if(4==u.readyState&&200==u.status){let t=JSON.parse(u.responseText);t.estado?(""==rowTable?tableUsuarios.api().ajax.reload():(htmlStatus=1==i?'<span class="badge badge-success">Activo</span>':'<span class="badge badge-danger">Inactivo</span>',rowTable.cells[1].textContent=o,rowTable.cells[2].textContent=r,rowTable.cells[3].textContent=n,rowTable.cells[4].textContent=s,rowTable.cells[5].textContent=document.querySelector("#listRolId").selectedOptions[0].text,rowTable.cells[6].textContent=document.querySelector("#listOrganizacionId").selectedOptions[0].text,rowTable.cells[7].innerHTML=htmlStatus),$("#modalFormUsuario").modal("hide"),e.reset(),swal("Usuarios",t.msg,"success")):swal("¡Error!",t.msg,"error")}return divLoading.style.display="none",!1}}},!1),window.addEventListener("load",function(){fntRolesUsuario(),fntOrganizacion()},!1);