function fntInputFile(){let e=document.querySelectorAll(".inputUploadFile");e.forEach(function(e){e.addEventListener("change",function(){let e=document.querySelector("#idProducto").value,t=this.parentNode.getAttribute("id"),n=this.getAttribute("id"),a=document.querySelector("#"+n).value,o=document.querySelector("#"+n).files,i=document.querySelector("#"+t+" .prevImage"),l=window.URL||window.webkitURL;if(""!=a){let n=o[0].type;o[0].name;if("image/jpeg"!=n&&"image/jpg"!=n&&"image/png"!=n)return i.innerHTML="Archivo no válido",a.value="",!1;{let n=l.createObjectURL(this.files[0]);i.innerHTML=`<img class="loading" src="${BaseUrl}/Assets/images/loading.svg">`;let a=BaseUrl+"/Productos/SetImage",o=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),r=new FormData;r.append("idproducto",e),r.append("foto",this.files[0]),o.open("POST",a,!0),o.send(r),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){let e=JSON.parse(o.responseText);e.status?(i.innerHTML=`<img src="${n}">`,document.querySelector("#"+t+" .btnDeleteImage").setAttribute("imgname",e.imgname),document.querySelector("#"+t+" .btnUploadFile").classList.add("notBlock"),document.querySelector("#"+t+" .btnDeleteImage").classList.remove("notBlock")):swal("Error",e.msg,"error")}}}}})})}function fntDelItem(e){let t=document.querySelector(e+" .btnDeleteImage").getAttribute("imgname"),n=document.querySelector("#idProducto").value,a=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),o=BaseUrl+"/Productos/DelFile",i=new FormData;i.append("idproducto",n),i.append("file",t),a.open("POST",o,!0),a.send(i),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){let t=JSON.parse(a.responseText);if(t.status){let t=document.querySelector(e);t.parentNode.removeChild(t)}else swal("Error",t.msg,"error")}}}function fntOrganizacion(){let e=BaseUrl+"/Organizaciones/GetSelectOrganizaciones",t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e,!0),t.send(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.querySelector("#listOrganizacionId").innerHTML=t.responseText,$("#listOrganizacionId").selectpicker("render"))}}function fntTipoAnimal(){let e=BaseUrl+"/TipoAnimal/GetSelectTipoAnimal",t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e,!0),t.send(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.querySelector("#listTipoAnimalId").innerHTML=t.responseText,$("#listTipoAnimalId").selectpicker("render"))}}function openModal(){document.querySelector("#idAnimal").value="",document.querySelector(".modal-header").classList.replace("headerUpdate","headerRegister"),document.querySelector("#btnActionForm").classList.replace("btn-info","btn-primary"),document.querySelector("#btnText").innerHTML="Guardar",document.querySelector("#titleModal").innerHTML="Nuevo animal",document.querySelector("#formAnimal").reset(),$("#modalFormAnimal").modal("show"),document.querySelector("#containerGallery").classList.add("notBlock"),document.querySelector("#containerImage").innerHTML="",rowTable=""}function fntViewAnimal(e){let t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),n=BaseUrl+"/Animales/GetAnimal/"+e;t.open("GET",n,!0),t.send(),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);if(e.status){let t="",n=1==e.data.estado?'<span class="badge badge-success">Activo</span>':'<span class="badge badge-danger">Inactivo</span>';if(document.querySelector("#celCodigo").innerHTML=e.data.idAnimal,document.querySelector("#celNombre").innerHTML=e.data.nombre,document.querySelector("#celOrganizacion").innerHTML=e.data.idOrganizacion,document.querySelector("#celTipoAnimal").innerHTML=e.data.idTipoAnimal,document.querySelector("#celGenero").innerHTML=e.data.genero,document.querySelector("#celFechaNacimiento").innerHTML=e.data.fecha_nacimiento,document.querySelector("#celEstado").innerHTML=n,e.data.images.length>0){let n=e.data.images;for(let e=0;e<n.length;e++)t+=`<img src="${n[e].url_image}"></img>`}document.querySelector("#celFotos").innerHTML=t,$("#modalViewAnimal").modal("show")}else swal("¡Error!",e.msg,"error")}}}function fntEditAnimal(e,t){rowTable=e.parentNode.parentNode.parentNode,document.querySelector(".modal-header").classList.replace("headerRegister","headerUpdate"),document.querySelector("#btnActionForm").classList.replace("btn-primary","btn-info"),document.querySelector("#btnText").innerHTML="Actualizar",document.querySelector("#titleModal").innerHTML="Actualizar Animal";let n=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),a=BaseUrl+"/Animales/GetAnimal/"+t;n.open("GET",a,!0),n.send(),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){let e=JSON.parse(n.responseText);if(e.status){let t="";document.querySelector("#idAnimal").value=e.data.idAnimal,document.querySelector("#txtNombre").value=e.data.nombre,document.querySelector("#listOrganizacionId").value=e.data.idOrganizacion,document.querySelector("#listTipoAnimalId").value=e.data.idTipoAnimal,document.querySelector("#txtGenero").value=e.data.genero;const n=new Date(e.data.fecha_nacimiento),a=n.toISOString().slice(0,10);if(document.querySelector("#fechaNacimiento").value=a,document.querySelector("#listStatus").value=e.data.estado,$("#listOrganizacionId").selectpicker("render"),$("#listStatus").selectpicker("render"),$("#listTipoAnimalId").selectpicker("render"),e.data.images.length>0){let n=e.data.images;for(let e=0;e<n.length;e++){let a=Date.now()+e;t+=`<div id="div${a}">\n\t\t\t\t\t\t<div class="prevImage">\n\t\t\t\t\t\t<img src="${n[e].url_image}"></img></div>\n\t\t\t            <button class="btnDeleteImage" type="button" onclick="fntDelItem('#div${a}')" imgname="${n[e].img}"><i class="fas fa-trash-alt"></i></button></div>`}}document.querySelector("#containerImage").innerHTML=t,$("#modalFormAnimal").modal("show")}else swal("¡Error!",e.msg,"error")}}}function fntDelAnimal(e){swal({title:"Eliminar Animal",text:"¿Realente quiere eliminar el Animal?",type:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){if(t){divLoading.style.display="flex";let t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),n=BaseUrl+"/Animales/DelAnimal/",a="idAnimal="+e;t.open("POST",n,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(a),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);e.status?(swal("¡Eliminar!",e.msg,"success"),tableAnimales.api().ajax.reload()):swal("¡Error!",e.msg,"error")}return divLoading.style.display="none",!1}}})}let tableAnimales,rowTable;document.write(`<script type="text/javascript" src="${BaseUrl}/Assets/js/plugins/JsBarcode.all.min.js"></script>`);let divLoading=document.querySelector("#divLoading");$(document).on("focusin",function(e){$(e.target).closest(".tox-dialog").length&&e.stopImmediatePropagation()}),window.addEventListener("load",function(){if(tableAnimales=$("#tableAnimales").dataTable({aProcessing:!0,aServerSide:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"},ajax:{url:BaseUrl+"/Animales/GetAnimales",dataSrc:""},columns:[{data:"idAnimal"},{data:"nombre"},{data:"organizacion"},{data:"tipoAnimal"},{data:"genero"},{data:"fecha_nacimiento"},{data:"estado"},{data:"options"}],columnDefs:[{className:"textcenter",targets:[3]},{className:"textrigth",targets:[4]},{className:"textcenter",targets:[5]}],dom:"lBfrtip",buttons:[{extend:"copyHtml5",text:"<i class='fas fa-copy'></i> Copiar",titleAttr:"Copiar",className:"btn btn-secondary",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"excelHtml5",text:"<i class='fas fa-file-excel'></i> Excel",titleAttr:"Exportar a Excel",className:"btn btn-success",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"pdfHtml5",text:"<i class='fas fa-file-pdf'></i> PDF",titleAttr:"Exportar a PDF",className:"btn btn-danger",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"csvHtml5",text:"<i class='fas fa-file-csv'></i> CSV",titleAttr:"Exportar a CSV",className:"btn btn-info",exportOptions:{columns:[0,1,2,3,4,5]}}],responsive:"true",bDestroy:!0,iDisplayLength:10,order:[[2,"asc"]]}),document.querySelector("#formAnimal")){let e=document.querySelector("#formAnimal");e.onsubmit=function(t){t.preventDefault();let n=document.querySelector("#txtNombre").value,a=document.querySelector("#txtGenero").value,o=document.querySelector("#listOrganizacionId").value,i=document.querySelector("#listTipoAnimalId").value,l=document.querySelector("#fechaNacimiento").value,r=document.querySelector("#listStatus").value;if(""==n||""==a||""==o||""==i||""==r)return swal("Atención","Todos los campos son obligatorios","error"),!1;divLoading.style.display="flex",tinyMCE.triggerSave();let s=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),c=BaseUrl+"/Animales/SetAnimal",d=new FormData(e);s.open("POST",c,!0),s.send(d),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){let t=JSON.parse(s.responseText);if(t.status)if(swal("Animales",t.msg,"success"),document.querySelector("#idAnimal").value=t.idAnimal,document.querySelector("#containerGallery").classList.remove("notBlock"),""==rowTable)tableAnimales.api().ajax.reload();else{htmlStatus=1==r?'<span class="badge badge-success">Activo</span>':'<span class="badge badge-danger">Inactivo</span>',rowTable.cells[1].textContent=n;const e=document.querySelector("#listOrganizacionId"),t=e.options[e.selectedIndex],o=t.textContent;rowTable.cells[2].textContent=o;const i=document.querySelector("#listOrganizacionId"),s=i.options[i.selectedIndex],c=s.textContent;rowTable.cells[3].textContent=c,rowTable.cells[4].textContent=a,rowTable.cells[5].textContent=l,rowTable.cells[6].innerHTML=htmlStatus,rowTable=""}else swal("¡Error!",t.msg,"error");$("#modalFormAnimal").modal("hide"),e.reset()}return divLoading.style.display="none",!1}}}if(document.querySelector(".btnAddImage")){let e=document.querySelector(".btnAddImage");e.onclick=function(e){let t=Date.now(),n=document.createElement("div");n.id="div"+t,n.innerHTML=`\n\t\t\t<div class="prevImage"></div>\n            <input type="file" name="foto" id="img${t}" class="inputUploadFile" accept="image/jpg, image/jpeg, image/png">\n            <label class="btnUploadFile" for="img${t}"><i class="fas fa-upload"></i></label>\n            <button class="btnDeleteImage notBlock" type="button" onclick="fntDelItem('#div${t}')"><i class="fas fa-trash-alt"></i></button>`,document.querySelector("#containerImage").appendChild(n),document.querySelector("#div"+t+" .btnUploadFile").click(),fntInputFile()}}},!1),tinymce.init({selector:"#txtDescripcion",width:"100%",height:400,statubar:!0,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons"}),window.addEventListener("load",function(){fntOrganizacion(),fntTipoAnimal()},!1);