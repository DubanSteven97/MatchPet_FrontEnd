function fntInputFile(){let e=document.querySelectorAll(".inputUploadFile");e.forEach(function(e){e.addEventListener("change",function(){let e=document.querySelector("#idAnimal").value,t=this.parentNode.getAttribute("id"),a=this.getAttribute("id"),n=document.querySelector("#"+a).value,i=document.querySelector("#"+a).files,o=document.querySelector("#"+t+" .prevImage");window.URL||window.webkitURL;if(""!=n){let a=i[0].type;i[0].name;if("image/jpeg"!=a&&"image/jpg"!=a&&"image/png"!=a)return o.innerHTML="Archivo no válido",n.value="",!1;{convertirABase64(i[0]).then(e=>{o.innerHTML=`<img class="loading" src="${e}">`}).catch(e=>{console.error(e)});let a=BaseUrl+"/Animales/SetImage",n=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),r=new FormData;r.append("idAnimal",e),r.append("foto",this.files[0]),n.open("POST",a,!0),n.send(r),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){let e=JSON.parse(n.responseText);e.status?(convertirABase64(i[0]).then(t=>{o.innerHTML=`<img src="${t}"  id="imgAnimal" alt="${e.idImagen}">`}).catch(e=>{console.error(e)}),document.querySelector("#"+t+" .btnUploadFile").classList.add("notBlock"),document.querySelector("#"+t+" .btnDeleteImage").classList.remove("notBlock")):swal("Error",e.msg,"error")}}}}})})}function fntDelItem(e){let t=document.querySelector("#idAnimal").value,a=document.querySelector("#imgAnimal").alt,n=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),i=BaseUrl+"/Animales/DelFile",o=new FormData;o.append("idAnimal",t),o.append("idImagen",a),n.open("POST",i,!0),n.send(o),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){let t=JSON.parse(n.responseText);if(t.status){let t=document.querySelector(e);t.parentNode.removeChild(t)}else swal("Error",t.msg,"error")}}}function fntOrganizacion(){let e=BaseUrl+"/Organizaciones/GetSelectOrganizaciones",t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e,!0),t.send(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.querySelector("#listOrganizacionId").innerHTML=t.responseText,$("#listOrganizacionId").selectpicker("refresh"))}}function fntTipoAnimal(){let e=BaseUrl+"/TipoAnimal/GetSelectTipoAnimal",t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e,!0),t.send(),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.querySelector("#listTipoAnimalId").innerHTML=t.responseText,$("#listTipoAnimalId").selectpicker("refresh"))}}function openModal(){document.querySelector("#idAnimal").value="",document.querySelector(".modal-header").classList.replace("headerUpdate","headerRegister"),document.querySelector("#btnActionForm").classList.replace("btn-info","btn-primary"),document.querySelector("#btnText").innerHTML="Guardar",document.querySelector("#titleModal").innerHTML="Nuevo animal",document.querySelector("#formAnimal").reset(),$("#modalFormAnimal").modal("show"),document.querySelector("#containerGallery").classList.add("notBlock"),document.querySelector("#containerImage").innerHTML="",rowTable=""}function fntViewAnimal(e){let t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),a=BaseUrl+"/Animales/GetAnimal/"+e;t.open("GET",a,!0),t.send(),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);if(e.status){let t="";switch(e.data.estado){case 1:estado='<span class="badge badge-success">Activo</span>';break;case 2:estado='<span class="badge badge-danger">Inactivo</span>';break;case 3:estado='<span class="badge badge-primary">En proceso</span>';break;case 4:estado='<span class="badge badge-success">Adoptado</span>';break;default:estado='<span class="badge badge-secondary">Estado desconocido</span>'}if(document.querySelector("#celCodigo").innerHTML=e.data.idAnimal,document.querySelector("#celNombre").innerHTML=e.data.nombre,document.querySelector("#celOrganizacion").innerHTML=e.data.idOrganizacion,document.querySelector("#celTipoAnimal").innerHTML=e.data.idTipoAnimal,document.querySelector("#celGenero").innerHTML=e.data.genero,document.querySelector("#celFechaNacimiento").innerHTML=e.data.fecha_nacimiento,document.querySelector("#celDescripcion").innerHTML=e.data.descripcion,document.querySelector("#celEstado").innerHTML=estado,e.data.images.length>0){let a=e.data.images;for(let e=0;e<a.length;e++)t+=`<img src="${a[e].url_image}" id="imgAnimal" alt="${a[e].id_image}"></img>`}document.querySelector("#celFotos").innerHTML=t,$("#modalViewAnimal").modal("show")}else swal("¡Error!",e.msg,"error")}}}function fntEditAnimal(e,t){rowTable=e.parentNode.parentNode.parentNode,document.querySelector(".modal-header").classList.replace("headerRegister","headerUpdate"),document.querySelector("#btnActionForm").classList.replace("btn-primary","btn-info"),document.querySelector("#btnText").innerHTML="Actualizar",document.querySelector("#titleModal").innerHTML="Actualizar Animal";let a=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),n=BaseUrl+"/Animales/GetAnimal/"+t;a.open("GET",n,!0),a.send(),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){let e=JSON.parse(a.responseText);if(e.status){let t="";document.querySelector("#idAnimal").value=e.data.idAnimal,document.querySelector("#txtNombre").value=e.data.nombre,document.querySelector("#txtDescripcion").value=e.data.descripcion,document.querySelector("#listOrganizacionId").value=e.data.idOrganizacion,document.querySelector("#listTipoAnimalId").value=e.data.idTipoAnimal,document.querySelector("#txtGenero").value=e.data.genero;const a=new Date(e.data.fecha_nacimiento),n=a.toISOString().slice(0,10);if(document.querySelector("#fechaNacimiento").value=n,e.data.descripcion&&tinymce.activeEditor.setContent(e.data.descripcion),document.querySelector("#listStatus").value=e.data.estado,$("#listOrganizacionId").selectpicker("refresh"),$("#listStatus").selectpicker("refresh"),$("#listTipoAnimalId").selectpicker("refresh"),$("#txtGenero").selectpicker("refresh"),e.data.images.length>0){let a=e.data.images;for(let e=0;e<a.length;e++){let n=Date.now()+e;t+=`<div id="div${n}">\n\t\t\t\t\t\t<div class="prevImage">\n\t\t\t\t\t\t<img src="${a[e].url_image}" id="imgAnimal" alt="${a[e].id_image}"></img></div>\n\t\t\t            <button class="btnDeleteImage" type="button" onclick="fntDelItem('#div${n}')" imgname="${a[e].img}"><i class="fas fa-trash-alt"></i></button></div>`}}document.querySelector("#containerImage").innerHTML=t,$("#modalFormAnimal").modal("show")}else swal("¡Error!",e.msg,"error")}}}function convertirABase64(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=(()=>{t(n.result)}),n.onerror=(e=>{a(e)}),e?n.readAsDataURL(e):a(new Error("Archivo no válido"))})}function fntDelAnimal(e){swal({title:"Eliminar Animal",text:"¿Realente quiere eliminar el Animal?",type:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",cancelButtonText:"No, cancelar",closeOnConfirm:!1,closeOnCancel:!0},function(t){if(t){divLoading.style.display="flex";let t=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),a=BaseUrl+"/Animales/DelAnimal/",n="idAnimal="+e;t.open("POST",a,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(n),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let e=JSON.parse(t.responseText);e.status?(swal("¡Eliminar!",e.msg,"success"),tableAnimales.api().ajax.reload()):swal("¡Error!",e.msg,"error")}return divLoading.style.display="none",!1}}})}let tableAnimales,rowTable;document.write(`<script type="text/javascript" src="${BaseUrl}/Assets/js/plugins/JsBarcode.all.min.js"></script>`);let divLoading=document.querySelector("#divLoading");$(document).on("focusin",function(e){$(e.target).closest(".tox-dialog").length&&e.stopImmediatePropagation()}),window.addEventListener("load",function(){if(tableAnimales=$("#tableAnimales").dataTable({aProcessing:!0,aServerSide:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"},ajax:{url:BaseUrl+"/Animales/GetAnimales",dataSrc:""},columns:[{data:"idAnimal"},{data:"nombre"},{data:"organizacion"},{data:"tipoAnimal"},{data:"genero"},{data:"fecha_nacimiento"},{data:"estado"},{data:"options"}],columnDefs:[{className:"textcenter",targets:[3]},{className:"textrigth",targets:[4]},{className:"textcenter",targets:[5]}],dom:"lBfrtip",buttons:[{extend:"copyHtml5",text:"<i class='fas fa-copy'></i> Copiar",titleAttr:"Copiar",className:"btn btn-secondary",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"excelHtml5",text:"<i class='fas fa-file-excel'></i> Excel",titleAttr:"Exportar a Excel",className:"btn btn-success",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"pdfHtml5",text:"<i class='fas fa-file-pdf'></i> PDF",titleAttr:"Exportar a PDF",className:"btn btn-danger",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"csvHtml5",text:"<i class='fas fa-file-csv'></i> CSV",titleAttr:"Exportar a CSV",className:"btn btn-info",exportOptions:{columns:[0,1,2,3,4,5]}}],responsive:"true",bDestroy:!0,iDisplayLength:10,order:[[2,"asc"]]}),document.querySelector("#formAnimal")){let e=document.querySelector("#formAnimal");e.onsubmit=function(t){t.preventDefault();let a=document.querySelector("#txtNombre").value,n=document.querySelector("#txtGenero").value,i=document.querySelector("#listOrganizacionId").value,o=document.querySelector("#listTipoAnimalId").value,r=document.querySelector("#fechaNacimiento").value,l=document.querySelector("#listStatus").value;if(""==a||""==n||""==i||""==o||""==l)return swal("Atención","Todos los campos son obligatorios","error"),!1;divLoading.style.display="flex",tinyMCE.triggerSave();let s=window.XMLHttpRequest?XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),c=BaseUrl+"/Animales/SetAnimal",d=new FormData(e);s.open("POST",c,!0),s.send(d),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){let e=JSON.parse(s.responseText);if(e.status)if(swal("Animales",e.msg,"success"),document.querySelector("#idAnimal").value=e.idAnimal,document.querySelector("#containerGallery").classList.remove("notBlock"),""==rowTable)tableAnimales.api().ajax.reload();else{htmlStatus=1==l?'<span class="badge badge-success">Activo</span>':'<span class="badge badge-danger">Inactivo</span>',rowTable.cells[1].textContent=a;const e=document.querySelector("#listOrganizacionId"),t=e.options[e.selectedIndex],i=t.textContent;rowTable.cells[2].textContent=i;const o=document.querySelector("#listOrganizacionId"),s=o.options[o.selectedIndex],c=s.textContent;rowTable.cells[3].textContent=c,rowTable.cells[4].textContent=n,rowTable.cells[5].textContent=r,rowTable.cells[6].innerHTML=htmlStatus,rowTable=""}else swal("¡Error!",e.msg,"error")}return divLoading.style.display="none",!1}}}if(document.querySelector(".btnAddImage")){let e=document.querySelector(".btnAddImage");e.onclick=function(e){let t=Date.now(),a=document.createElement("div");a.id="div"+t,a.innerHTML=`\n\t\t\t<div class="prevImage"></div>\n            <input type="file" name="foto" id="img${t}" class="inputUploadFile" accept="image/jpg, image/jpeg, image/png">\n            <label class="btnUploadFile" for="img${t}"><i class="fas fa-upload"></i></label>\n            <button class="btnDeleteImage notBlock" type="button" onclick="fntDelItem('#div${t}')"><i class="fas fa-trash-alt"></i></button>`,document.querySelector("#containerImage").appendChild(a),document.querySelector("#div"+t+" .btnUploadFile").click(),fntInputFile()}}},!1),tinymce.init({selector:"#txtDescripcion",width:"100%",height:400,statubar:!0,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons"}),window.addEventListener("load",function(){fntOrganizacion(),fntTipoAnimal()},!1);